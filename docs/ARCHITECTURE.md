# é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“ æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œå°†ä»£ç æŒ‰åŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½é¢†åŸŸã€‚

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer          â”‚
â”‚  (index.html, styles/main.css)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Game     â”‚  â”‚    UI     â”‚   â”‚
â”‚  â”‚  (Core)    â”‚  â”‚ (Display) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Domain Layer                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Player  â”‚  â”‚   NPC    â”‚       â”‚
â”‚  â”‚ (Entity) â”‚  â”‚ (Entity) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Maze    â”‚  â”‚Multiplayerâ”‚       â”‚
â”‚  â”‚(Generator)â”‚ â”‚ (Network) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Configuration Layer          â”‚
â”‚         (config/config.js)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ¨¡å—èŒè´£

### 1. é…ç½®æ¨¡å— (`js/config/`)
**èŒè´£**: å­˜å‚¨æ‰€æœ‰é…ç½®å¸¸é‡
- å…³å¡é…ç½®ï¼ˆLIFE_LEVELSï¼‰
- æ¸¸æˆå‚æ•°ï¼ˆCONFIGï¼‰
- è§’è‰²é…ç½®ï¼ˆCHARACTERSï¼‰
- é¢œè‰²æ˜ å°„ï¼ˆPLAYER_COLORSï¼‰

**ç‰¹ç‚¹**: 
- çº¯æ•°æ®ï¼Œæ— ä¸šåŠ¡é€»è¾‘
- å…¨å±€å¯è®¿é—®
- æ˜“äºä¿®æ”¹å’Œæ‰©å±•

### 2. æ ¸å¿ƒæ¨¡å— (`js/core/`)

#### game.js - æ¸¸æˆä¸»é€»è¾‘
**èŒè´£**:
- åœºæ™¯åˆå§‹åŒ–å’Œç®¡ç†
- å…³å¡åŠ è½½å’Œåˆ‡æ¢
- åŠ¨ç”»å¾ªç¯
- æ¸¸æˆçŠ¶æ€ç®¡ç†
- ç›¸æœºæ§åˆ¶

**ä¾èµ–**: MazeGenerator, Player, NPC, UI, Multiplayer

#### maze.js - è¿·å®«ç”Ÿæˆ
**èŒè´£**:
- è¿·å®«ç®—æ³•å®ç°ï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰
- å¢™å£å’Œåœ°é¢åˆ›å»º
- æè´¨ç®¡ç†
- è·¯å¾„æŸ¥æ‰¾ï¼ˆBFSï¼‰

**ä¾èµ–**: CONFIG, LIFE_LEVELS

### 3. å®ä½“æ¨¡å— (`js/entities/`)

#### player.js - ç©å®¶æ§åˆ¶
**èŒè´£**:
- é”®ç›˜è¾“å…¥å¤„ç†
- ç§»åŠ¨å’Œè·³è·ƒé€»è¾‘
- ç©å®¶æ¨¡å‹åˆ›å»º
- æ‹–å°¾æ•ˆæœ

**ä¾èµ–**: Game, MazeGenerator, Multiplayer, UI

#### npc.js - NPC å’Œé“å…·
**èŒè´£**:
- NPC åˆ›å»ºï¼ˆæ€ªå…½ã€æé¾™ã€å¥³é¬¼ï¼‰
- ç¢°æ’æ£€æµ‹
- é“å…·ç³»ç»Ÿï¼ˆè¡€åŒ…ã€å¼¹è·³åŒ…ï¼‰
- NPC åŠ¨ç”»

**ä¾èµ–**: Game, MazeGenerator, Player, UI

### 4. å¤šäººæ¸¸æˆæ¨¡å— (`js/multiplayer/`)

#### multiplayer.js - ç½‘ç»œé€šä¿¡
**èŒè´£**:
- WebSocket è¿æ¥ç®¡ç†
- æˆ¿é—´åˆ›å»ºå’ŒåŠ å…¥
- ç©å®¶åŒæ­¥
- æ¶ˆæ¯å¤„ç†
- æ’è¡Œæ¦œæ›´æ–°

**ä¾èµ–**: Game, Player, UI

### 5. UI æ¨¡å— (`js/ui/`)

#### ui.js - ç”¨æˆ·ç•Œé¢
**èŒè´£**:
- UI å…ƒç´ æ›´æ–°
- è¡€é‡/è·³è·ƒæ¬¡æ•°æ˜¾ç¤º
- æ’è¡Œæ¦œæ˜¾ç¤º
- ç‰¹æ•ˆæ˜¾ç¤ºï¼ˆä¼¤å®³ã€æ‹¾å–ç­‰ï¼‰

**ä¾èµ–**: Game, Multiplayer

## ğŸ”„ æ¨¡å—é€šä¿¡

### é€šä¿¡æ–¹å¼

1. **ç›´æ¥å¼•ç”¨**: æ¨¡å—é€šè¿‡å…¨å±€å¯¹è±¡è®¿é—®å…¶ä»–æ¨¡å—
   ```javascript
   if (typeof Player !== 'undefined') {
       Player.executeMove();
   }
   ```

2. **äº‹ä»¶ç³»ç»Ÿ**: é€šè¿‡ DOM äº‹ä»¶æˆ–è‡ªå®šä¹‰äº‹ä»¶é€šä¿¡
   ```javascript
   document.dispatchEvent(new CustomEvent('gameEvent', { detail: data }));
   ```

3. **å…±äº«çŠ¶æ€**: é€šè¿‡å…¨å±€å¯¹è±¡å…±äº«çŠ¶æ€
   ```javascript
   Game.currentLevel
   Player.playerPos
   ```

### ä¾èµ–å…³ç³»å›¾

```
Config
  â†“
Maze â† Game â† Player
  â†“      â†“      â†“
       NPC    Multiplayer
         â†“      â†“
          UI â†â”€â”€â”˜
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½é¢†åŸŸã€‚

### 2. ä¾èµ–å€’ç½®
é«˜å±‚æ¨¡å—ï¼ˆGameï¼‰ä¸ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œè€Œæ˜¯é€šè¿‡æ¥å£/çº¦å®šé€šä¿¡ã€‚

### 3. å¼€é—­åŸåˆ™
æ¨¡å—å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚æ–°å¢åŠŸèƒ½é€šè¿‡æ‰©å±•è€Œéä¿®æ”¹å®ç°ã€‚

### 4. å‘½åç©ºé—´éš”ç¦»
æ¯ä¸ªæ¨¡å—ä½¿ç”¨ç‹¬ç«‹çš„å‘½åç©ºé—´å¯¹è±¡ï¼Œé¿å…å…¨å±€æ±¡æŸ“ã€‚

## ğŸ”§ æœ€ä½³å®è·µ

### 1. æ¨¡å—åˆå§‹åŒ–
```javascript
// åœ¨ DOMContentLoaded æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    UI.init();
    Multiplayer.init();
});
```

### 2. é”™è¯¯å¤„ç†
```javascript
// æ£€æŸ¥æ¨¡å—æ˜¯å¦å­˜åœ¨
if (typeof Player !== 'undefined' && Player.executeMove) {
    Player.executeMove();
}
```

### 3. çŠ¶æ€åŒæ­¥
```javascript
// åŒæ­¥çŠ¶æ€åˆ°ç›¸å…³æ¨¡å—
if (typeof Player !== 'undefined') {
    Player.playerPos = { x: 0, z: 0 };
}
```

### 4. èµ„æºè·¯å¾„
```javascript
// ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ”¯æŒä¸åŒéƒ¨ç½²ç¯å¢ƒ
const avatarPath = 'assets/images/1.jpg';
```

## ğŸ“ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°å®ä½“**: åœ¨ `js/entities/` åˆ›å»ºæ–°æ–‡ä»¶
2. **æ–°UIç»„ä»¶**: åœ¨ `js/ui/ui.js` ä¸­æ·»åŠ æ–¹æ³•
3. **æ–°é…ç½®**: åœ¨ `js/config/config.js` ä¸­æ·»åŠ å¸¸é‡
4. **æ–°ç½‘ç»œåŠŸèƒ½**: åœ¨ `js/multiplayer/multiplayer.js` ä¸­æ·»åŠ æ–¹æ³•

### ä¿®æ”¹ç°æœ‰åŠŸèƒ½

1. æ‰¾åˆ°å¯¹åº”çš„æ¨¡å—æ–‡ä»¶
2. ä¿®æ”¹ç›¸å…³æ–¹æ³•
3. ç¡®ä¿ä¸å½±å“å…¶ä»–æ¨¡å—
4. æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **æŒ‰éœ€åŠ è½½**: å¯ä»¥æ”¹ä¸ºåŠ¨æ€å¯¼å…¥æ¨¡å—
2. **èµ„æºç¼“å­˜**: å›¾ç‰‡å’Œæè´¨å¯ä»¥ç¼“å­˜
3. **å¯¹è±¡æ± **: NPC å’Œé“å…·å¯ä»¥ä½¿ç”¨å¯¹è±¡æ± 
4. **äº‹ä»¶èŠ‚æµ**: ä½ç½®æ›´æ–°ä½¿ç”¨èŠ‚æµ

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥éœ€è¦éªŒè¯
2. **XSS é˜²æŠ¤**: åŠ¨æ€ HTML éœ€è¦è½¬ä¹‰
3. **WebSocket å®‰å…¨**: ä½¿ç”¨ WSS åœ¨ç”Ÿäº§ç¯å¢ƒ
4. **èµ„æºéªŒè¯**: éªŒè¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®

## ğŸ“š å‚è€ƒ

- [Three.js æ–‡æ¡£](https://threejs.org/docs/)
- [WebSocket API](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)
- [æ¨¡å—åŒ– JavaScript](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)
